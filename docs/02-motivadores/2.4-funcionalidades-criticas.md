[游댗 Volver al README](./README.md)

# Funcionalidades Cr칤ticas

Las funcionalidades cr칤ticas son las operaciones esenciales con restricciones funcionales. A continuaci칩n, se listan con su tipo, descripci칩n y t치cticas/estrategias:

| Tipo de funcionalidad cr칤tica | Tipo especificaci칩n funcionalidad cr칤tica | Descripci칩n | T치ctica/Estrategia (Nombre t치ctica) | Descripci칩n estrategia |
|-------------------------------|-------------------------------------------|-------------|-------------------------------------|------------------------|
| Reto t칠cnico | Requerimiento funcional | REQ-FUN-001 - El sistema debe permitir v치lidar la que la direcci칩n de correo electronico si exista y le pertenesca al usuario, debe enviar un c칩digo de verificaci칩n al correo electr칩nico, para habilitar el acceso a la plataforma. | Implementaci칩n de Firebase Auth | Firebase Auth garantiza que los usuarios puedan registrarse y verificar su cuenta de manera segura, r치pida y confiable. Esto delega la complejidad de la gesti칩n de usuarios y la seguridad de contrase침as a una plataforma especializada, permitiendo que el desarrollo se enfoque en la l칩gica de negocio de Nexa. Un plus es que nexa va a usar servicio de storage ne firebase. |
| Reto t칠cnico | Requerimiento funcional | REQ-FUN-002 - El sistema debe detectar autom치ticamente cuando un usuario no ha realizado el pago de su suscripci칩n en la fecha l칤mite establecida. | Integraci칩n con el sdk de Stripe para suscripciones | Se integra Stripe Billing para gestionar las suscripciones de los usuarios. Stripe notifica autom치ticamente al sistema cuando un pago falla o expira. Esta estrategia garantiza automatizaci칩n total, seguridad en los pagos y protecci칩n del modelo de negocio, sin necesidad de verificar manualmente cada transacci칩n. |
| Impacto o promesa de valor para el negocio | Requerimiento funcional | REQ-FUN-003 - El sistema debe cambiar el estado de todas las tiendas pertenecientes a un usuario de acuerdo al estado de su suscripci칩n. | Manejo de estados en base de datos/ sdk Stripe | De acuerdo al estado de la suscripci칩n de un usuario se debe poder actualizar el estado de sus tiendas asociadas en la base de datos. |
| Impacto o promesa de valor para el negocio | Requerimiento funcional | REQ-FUN-004 - El usuario debe recibir una notificaci칩n autom치tica por correo electr칩nico, que informe la causa de la suspensi칩n de su cuenta. | Integraci칩n con la API de Mailgun | Se utilizar치 la API de Mailgun en el backend para enviar correos electr칩nicos de forma program치tica. Cuando se active la l칩gica de suspensi칩n, el sistema de Nexa invocar치 la API de Mailgun con los datos del usuario. El correo contendr치 un mensaje predefinido que explicar치 la raz칩n del impago y las instrucciones claras para reactivar la suscripci칩n. |
| Impacto o promesa de valor para el negocio | Requerimiento funcional | REQ-FUN-005 - El sistema debe permitir que un usuario pueda reactivar su suscripci칩n manualmente a trav칠s de un proceso de pago iniciado en la secci칩n "Suscripci칩n". | Integraci칩n de Flujo de Pago con Stripe | Se implementar치 un flujo de pago con el SDK de Stripe que, al seleccionar un plan gestiona todo el proceso. Esto simplifica el proceso de compra y delega a Stripe la responsabilidad de manejar los datos sensibles de la tarjeta y la confirmaci칩n del pago. Al completarse exitosamente, Stripe enviara una confirmaci칩n para activar la l칩gica de reactivaci칩n. |
| Impacto o promesa de valor para el negocio | Requerimiento funcional | REQ-FUN-006 - El sistema debe enviar una confirmaci칩n autom치tica por correo electr칩nico al usuario una vez que su suscripci칩n ha exitosa. | Integraci칩n con la API de Mailgun | Se utilizar치 la API de Mailgun para enviar correos. El backend de Nexa invocar치 la API con el correo del usuario y el contenido del mensaje de confirmaci칩n. Este correo sirve como prueba tangible para el usuario de que su pago fue procesado exitosamente y que su cuenta y tiendas han sido reactivadas, lo que genera confianza y cumple con un est치ndar de servicio profesional. |
| Impacto o promesa de valor para el negocio / Reto t칠cnico | Requerimiento funcional | REQ-FUN-007 - El sistema debe permitir la creaci칩n de una tienda, generando al mismo tiempo la suscripci칩n ligada al pago inicial. | Integraci칩n con Stripe y Gesti칩n en Base de Datos | Se implementar치 una l칩gica de negocio que asocia la creaci칩n de la tienda con un flujo de pago orquestado por la API de Stripe. Al crear la tienda en la base de datos, el sistema le asignar치 un estado inicial de "pendiente". Posteriormente, se generar치 una sesi칩n de pago con Stripe. Solo al recibir la confirmaci칩n de pago exitoso (a trav칠s de un webhook de Stripe), el sistema actualizar치 el estado de la tienda en la base de datos de "pendiente" a "activa", completando as칤 el proceso. |
| Impacto o promesa de valor para el negocio | Requerimiento funcional | REQ-FUN-008 - El sistema debe permitir al usuario debe poder activar o desactivar su tienda manualmente desde el panel de control. Al desactivar, la tienda y su contenido dejan de ser visibles p칰blicamente, pero no se eliminan los datos. | Implementaci칩n de un sistema de estados de las tiendas en base de datos | Se a침adir치 un campo estado a la entidad Tienda en la base de datos. La interfaz de usuario (UI) en el panel de control del usuario tendr치 un bot칩n o interruptor para cambiar este estado. La l칩gica del backend validar치 el cambio de estado y lo actualizar치 en la base de datos, lo que a su vez har치 que la tienda sea o no visible en el frontend p칰blico. |
| Impacto o promesa de valor para el negocio | Requerimiento funcional | REQ-FUN-009 - El cliente puede agregar productos al carrito. El contenido del carrito debe guardarse localmente hasta que se env칤e. | Persistencia h칤brida del carrito: almacenamiento local para usuarios no registrados y sincronizaci칩n con el backend(Redis)para usuarios registrados. | "Mientras el usuario no est치 registrado ni ha iniciado sesi칩n, Nexa guarda los productos del carrito en el navegador usando LocalStorage. Esto permite que el cliente mantenga su selecci칩n aunque recargue la p치gina o cierre la pesta침a. Sin embargo, esta informaci칩n solo vive en ese navegador: si el cliente cambia de dispositivo o borra la memoria local, el carrito se pierde. Para mejorar esta experiencia, al momento en que el cliente decide registrarse o iniciar sesi칩n, el sistema ofrece sincronizar el carrito local con el backend. En ese momento, los productos guardados en LocalStorage se env칤an a Redis, donde se almacenan de forma r치pida y temporal, pero ahora asociados al UID del usuario autenticado. Redis permite que el carrito est칠 disponible desde cualquier dispositivo. Desde ese punto en adelante, cualquier cambio en el carrito se actualiza directamente en Redis, y el cliente puede recuperar su selecci칩n desde cualquier lugar. Esta transici칩n es fluida: el usuario no pierde lo que ya hab칤a seleccionado, y el sistema le deja claro que al registrarse obtiene una experiencia m치s confiable y sincronizada" |
| Reto t칠cnico | Requerimiento funcional | REQ-FUN-010 - El sistema debe enviar el contenido del carrito de compras al vendedor v칤a WhatsApp, incluyendo la lista de productos y sus detalles. | Generaci칩n de URL de WhatsApp | Se implementar치 una funci칩n en el frontend que, al hacer clic en el bot칩n de "Enviar por WhatsApp", recopilar치 los detalles de cada producto en el carrito. Luego, crear치 el mensaje que contenga la lista de productos, cantidades y precios. Este mensaje din치mico ser치 el que se incluya en el enlace de WhatsApp, asegurando que el vendedor reciba de forma precisa el pedido completo. |
| Reto t칠cnico | Requerimiento funcional | REQ-FUN-011 - El sistema debe mostrar m칠tricas clave para la tienda, considerando 칰nicamente las ventas en estado entregada. | Event-Driven + Vistas Materializadas | Cada vez que una venta se marca como entregada, el sistema genera un evento. Ese evento actualiza una tabla o vista especial que guarda las m칠tricas ya calculadas (ej. ingresos acumulados, productos top, cliente top). As칤, cuando el administrador abre el panel, el sistema no tiene que calcular nada en ese momento, solo mostrar los resultados ya listos y actualizados autom치ticamente. |
| Reto t칠cnico | Requerimiento funcional | REQ-FUN-012 - El sistema debe manejar autom치ticamente el procesamiento de im치genes (optimizaci칩n, versiones, cacheo y validaci칩n de seguridad). | Procesamiento de im치genes en el backend | Se implementar치 un proceso de fondo en el backend para manejar las im치genes subidas. Este proceso forzar치 la conversi칩n al formato WebP o AVIF con una calidad del 75-80%, redimensionando la imagen a un tama침o m치ximo predefinido. Adem치s, crear치 dos versiones adicionales: una principal y una miniatura (thumbnail). Todas las im치genes procesadas se suben a un servicio de almacenamiento en la nube (como Firebase Storage), y se sirven a trav칠s de la CDN integrada de Vercel, lo que garantiza una entrega r치pida y eficiente a nivel global. Antes del procesamiento, se validar치 que el archivo corresponda exclusivamente a formatos de imagen permitidos (como JPG, PNG, WebP o AVIF), rechazando cualquier extensi칩n extra침a o no compatible para garantizar seguridad y consistencia en el flujo. Asimismo, se eliminar치n caracteres especiales o no est치ndar en el nombre del archivo, generando un identificador limpio y seguro que permita persistir la imagen sin riesgos ni ambig칲edades en el almacenamiento. |

## Detalles de Implementaci칩n

### Validaci칩n de Correo (REQ-FUN-001)
Firebase Auth garantiza verificaci칩n segura y confiable de cuentas.

### Gesti칩n de Pagos (REQ-FUN-002)
Stripe Billing maneja suscripciones y notifica autom치ticamente fallos.

### Estado de Tiendas (REQ-FUN-003)
Actualizaci칩n autom치tica basada en estado de suscripci칩n.

### Notificaciones (REQ-FUN-004/006)
Mailgun env칤a correos transaccionales de forma program치tica.

### Suscripciones (REQ-FUN-005/007)
Flujo integrado con Stripe para pagos y activaci칩n de tiendas.

### Control de Tienda (REQ-FUN-008)
Sistema de estados en base de datos con UI de control.

### Carrito (REQ-FUN-009)
Sistema h칤brido: LocalStorage + Redis para sincronizaci칩n.

### WhatsApp (REQ-FUN-010)
Generaci칩n din치mica de mensajes y enlaces.

### M칠tricas (REQ-FUN-011)
Sistema event-driven con vistas precalculadas.

### Im치genes (REQ-FUN-012)
Procesamiento autom치tico con optimizaci칩n y CDN.